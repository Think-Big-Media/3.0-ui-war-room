<!DOCTYPE html>
<html>
<head>
    <title>Diagnose Blank Page - War Room 2025</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        pre { background: #f0f0f0; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîç Diagnosing war-room-2025.onrender.com Blank Page</h1>
    <div id="results"></div>

    <script>
        async function diagnose() {
            const results = document.getElementById('results');
            let output = [];
            
            // 1. Check if HTML loads
            output.push('<h2>1. HTML & Assets Check</h2>');
            try {
                const response = await fetch('https://war-room-2025.onrender.com');
                const html = await response.text();
                
                // Check basic HTML structure
                if (html.includes('<div id="root"></div>')) {
                    output.push('<span class="success">‚úÖ Root div present</span>');
                } else {
                    output.push('<span class="error">‚ùå Root div missing!</span>');
                }
                
                // Extract JS file
                const jsMatch = html.match(/src="(\/assets\/index-[^"]+\.js)"/);
                if (jsMatch) {
                    output.push(`<span class="success">‚úÖ JS file found: ${jsMatch[1]}</span>`);
                    
                    // Try to load the JS
                    const jsUrl = `https://war-room-2025.onrender.com${jsMatch[1]}`;
                    const jsResponse = await fetch(jsUrl);
                    const jsText = await jsResponse.text();
                    
                    output.push(`<span class="success">‚úÖ JS loads: ${jsText.length} bytes</span>`);
                    
                    // Check for common issues in JS
                    if (jsText.includes('VITE_SUPABASE_URL')) {
                        output.push('<span class="warning">‚ö†Ô∏è JS contains VITE_SUPABASE_URL - might need env var</span>');
                    }
                    if (jsText.includes('process.env.REACT_APP_SUPABASE_URL')) {
                        output.push('<span class="warning">‚ö†Ô∏è JS expects REACT_APP_SUPABASE_URL env var</span>');
                    }
                    
                    // Look for initialization errors
                    if (jsText.includes('Cannot read properties of undefined')) {
                        output.push('<span class="error">‚ùå JS has undefined property errors</span>');
                    }
                }
                
                // Extract CSS file
                const cssMatch = html.match(/href="(\/assets\/index-[^"]+\.css)"/);
                if (cssMatch) {
                    output.push(`<span class="success">‚úÖ CSS file found: ${cssMatch[1]}</span>`);
                    const cssResponse = await fetch(`https://war-room-2025.onrender.com${cssMatch[1]}`);
                    if (cssResponse.ok) {
                        output.push('<span class="success">‚úÖ CSS loads successfully</span>');
                    }
                }
                
            } catch (e) {
                output.push(`<span class="error">‚ùå Error loading HTML: ${e.message}</span>`);
            }
            
            // 2. Check Console Errors via iframe
            output.push('<h2>2. Console Error Detection</h2>');
            output.push('<p>Opening site in iframe to capture console errors...</p>');
            
            const iframe = document.createElement('iframe');
            iframe.src = 'https://war-room-2025.onrender.com';
            iframe.style.width = '100%';
            iframe.style.height = '400px';
            iframe.style.border = '2px solid #ccc';
            
            // 3. Check API Health
            output.push('<h2>3. API Health Check</h2>');
            try {
                const healthResponse = await fetch('https://war-room-2025.onrender.com/health');
                const health = await healthResponse.json();
                output.push(`<span class="success">‚úÖ API Health: ${JSON.stringify(health, null, 2)}</span>`);
            } catch (e) {
                output.push(`<span class="error">‚ùå API Error: ${e.message}</span>`);
            }
            
            // 4. Check for CORS issues
            output.push('<h2>4. CORS & Headers Check</h2>');
            try {
                const headResponse = await fetch('https://war-room-2025.onrender.com', { method: 'HEAD' });
                const csp = headResponse.headers.get('content-security-policy');
                if (csp) {
                    output.push(`<span class="warning">‚ö†Ô∏è CSP Policy: ${csp.substring(0, 100)}...</span>`);
                    if (csp.includes("script-src 'self'") && !csp.includes('unsafe-inline')) {
                        output.push('<span class="error">‚ùå CSP might block inline scripts!</span>');
                    }
                }
            } catch (e) {
                output.push(`<span class="warning">‚ö†Ô∏è Could not check headers: ${e.message}</span>`);
            }
            
            // 5. Check what the backend is actually serving
            output.push('<h2>5. Backend Serving Check</h2>');
            try {
                // Check if static files are being served
                const faviconResponse = await fetch('https://war-room-2025.onrender.com/vite.svg');
                if (faviconResponse.ok) {
                    output.push('<span class="success">‚úÖ Static files are being served</span>');
                } else {
                    output.push('<span class="error">‚ùå Static files not found - backend might not be serving dist/</span>');
                }
            } catch (e) {
                output.push(`<span class="error">‚ùå Static file check failed: ${e.message}</span>`);
            }
            
            // 6. Compare with working deployment
            output.push('<h2>6. Comparison with Working Site (war-room-oa9t)</h2>');
            try {
                const oldResponse = await fetch('https://war-room-oa9t.onrender.com');
                const oldHtml = await oldResponse.text();
                const oldJsMatch = oldHtml.match(/src="(\/assets\/index-[^"]+\.js)"/);
                
                output.push(`<span class="success">Working site JS: ${oldJsMatch ? oldJsMatch[1] : 'not found'}</span>`);
            } catch (e) {
                output.push(`<span class="warning">Could not compare: ${e.message}</span>`);
            }
            
            results.innerHTML = output.join('<br>') + '<br><br><h2>7. Live Site in iFrame:</h2>';
            results.appendChild(iframe);
            
            // Add console message
            results.innerHTML += '<br><p><strong>üëâ Open browser DevTools Console to see any JavaScript errors from the iframe!</strong></p>';
        }
        
        diagnose();
    </script>
</body>
</html>